jQuery(document).on("dragstart",".attachments-browser .attachments .attachment",function(e){jQuery(".uploader-window").addClass("uip-hidden"),allIDS=[],jQuery(".attachments-browser .attachments .attachment[aria-checked='true']").length>0?(jQuery(".attachments-browser .attachments .attachment[aria-checked='true']").each(function(e){tempid=jQuery(this).attr("data-id"),allIDS.push(tempid)}),e.originalEvent.dataTransfer.setData("itemID",JSON.stringify(allIDS))):(theid=jQuery(e.currentTarget).attr("data-id"),e.originalEvent.dataTransfer.setData("itemID",JSON.stringify([theid]))),thefiles=uipTranslations.oneFile,e.originalEvent.dataTransfer.dropEffect="move",e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.setData("type","content");var t=document.createElement("div");t.id="uip-content-drag",t.innerHTML=thefiles,t.style.position="absolute",t.style.top="-1000px",document.body.appendChild(t),e.originalEvent.dataTransfer.setDragImage(t,0,0),jQuery(".uip-remove-folder").addClass("uip-nothidden")}),jQuery(document).on("dragend",".attachments-browser .attachments .attachment",function(e){jQuery(".uip-remove-folder").removeClass("uip-nothidden")});const UIPfolderOptions={emits:["folder-change"],data:()=>({loading:!0,screenWidth:window.innerWidth,translations:uipTranslations,masterPrefs:uipMasterPrefs,defaults:uipDefaults,preferences:uipUserPrefs,mediaCount:0,noFolderCount:0,folders:[],activeFolder:"all",activeFolderObject:[],openFolders:[]}),watch:{},created:function(){window.addEventListener("resize",this.getScreenWidth)},computed:{formattedFolders(){return this.folders}},mounted:function(){this.getFolders(),jQuery(".attachment").attr("draggable","true")},methods:{getScreenWidth(){this.screenWidth=window.innerWidth},isSmallScreen(){return this.screenWidth<1e3},setActiveFolder(e,t){this.activeFolder=e,t&&(this.activeFolderObject=t),"undefined"==typeof uipContentPage?wp.media.frames.browse?wp.media.frames.browse.content.get().collection.props.set({folder_id:e}):wp.media.frame.content.get().collection.props.set({folder_id:e}):window.dispatchEvent(new CustomEvent("folder-change",{detail:{folder:e}}))},setOpenFolders(e){this.openFolders.includes(e)?(index=this.openFolders.indexOf(e),this.openFolders.splice(index,1)):this.openFolders.push(e),this.openFolders||(this.openFolders=[])},getFolders(){let e=this;contentPage="false","undefined"!=typeof uipContentPage&&(contentPage="true"),console.log(contentPage),data={action:"uip_get_folders",security:uip_ajax.security,contentPage:contentPage},jQuery.ajax({url:uip_ajax.ajax_url,type:"post",data:data,success:function(t){data=JSON.parse(t),e.loading=!1,data.error||(e.folders=data.folders,e.mediaCount=data.mediaCount,e.noFolderCount=data.noFolderCount)}})}},template:'<div class="">    <default-folders :mediaCount="mediaCount" :noFolderCount="noFolderCount" :translations="translations" :masterPrefs="masterPrefs" :defaults="defaults" :preferences="preferences"    :activeFolder="activeFolder" :folderUpdate="setActiveFolder"></default-folders>    <user-folders :activeFolderObject="activeFolderObject" :setOpenFolders="setOpenFolders" :openFolders="openFolders" :refreshFolders="getFolders" :translations="translations" :masterPrefs="masterPrefs" :defaults="defaults" :preferences="preferences"    :activeFolder="activeFolder" :folderUpdate="setActiveFolder" :folders="formattedFolders"></user-folders>  </div>'},UIPfolder=uipVue.createApp(UIPfolderOptions);UIPfolder.component("default-folders",{props:{translations:Object,masterPrefs:Object,defaults:Object,preferences:Object,folderUpdate:Function,activeFolder:[String,Number],mediaCount:Number,noFolderCount:Number},data:function(){return{loading:!0}},mounted:function(){},methods:{},template:'<div class="uip-margin-bottom-s">      <div @click="folderUpdate(\'all\')" :class="{\'uip-background-muted uip-text-bold uip-text-emphasis\' : activeFolder == \'all\'}"      class="uip-border-round uip-flex uip-padding-xxs uip-text-m hover:uip-background-muted uip-cursor-pointer uip-margin-bottom-xxs">        <span class="material-icons-outlined uip-margin-right-xxs">folder</span>        <span class="uip-flex-grow">{{translations.allContent}}</span>        <span class="uip-border-round uip-background-primary-wash uip-padding-left-xxs uip-padding-right-xxs">{{mediaCount}}</span>      </div>      <div @click="folderUpdate(\'nofolder\')"  :class="{\'uip-background-muted uip-text-bold uip-text-emphasis\' : activeFolder == \'nofolder\'}"      class="uip-border-round uip-flex uip-padding-xxs uip-text-m hover:uip-background-muted uip-cursor-pointer ">        <span class="material-icons-outlined uip-margin-right-xxs">folder</span>        <span class="uip-flex-grow">{{translations.noFolder}}</span>        <span class="uip-border-round uip-background-primary-wash uip-padding-left-xxs uip-padding-right-xxs">{{noFolderCount}}</span>      </div>    </div>'}),UIPfolder.component("user-folders",{props:{translations:Object,masterPrefs:Object,defaults:Object,preferences:Object,folderUpdate:Function,activeFolder:[String,Number],folders:Object,refreshFolders:Function,openFolders:Array,setOpenFolders:Function,activeFolderObject:Object},data:function(){return{loading:!0,ui:{createNew:{open:!1,name:"",color:"#0c5cef"},edit:{open:!1,active:this.activeFolderObject}}}},mounted:function(){},computed:{formattedFolders(){return this.folders}},methods:{openCreateFolder(){this.ui.createNew.open=!0},openEditFolder(){this.ui.edit.active=this.activeFolderObject,this.ui.edit.open=!0},deleteFolder(){let e=this;data={action:"uip_delete_folder",security:uip_ajax.security,activeFolder:e.activeFolder},jQuery.ajax({url:uip_ajax.ajax_url,type:"post",data:data,success:function(t){data=JSON.parse(t),e.loading=!1,data.error?uipNotification(data.error):(e.folderUpdate("all",{}),uipNotification(data.message),e.refreshFolders())}})},createFolder(){let e=this;data={action:"uip_create_folder",security:uip_ajax.security,folderInfo:e.ui.createNew,parent:e.activeFolder},jQuery.ajax({url:uip_ajax.ajax_url,type:"post",data:data,success:function(t){data=JSON.parse(t),e.loading=!1,data.error?uipNotification(data.error):(uipNotification(data.message),e.refreshFolders())}})},updateFolder(){let e=this;data={action:"uip_update_folder",security:uip_ajax.security,folderInfo:e.ui.edit.active},jQuery.ajax({url:uip_ajax.ajax_url,type:"post",data:data,success:function(t){data=JSON.parse(t),e.loading=!1,data.error?uipNotification(data.error):(uipNotification(data.message),e.refreshFolders())}})},addDropClass(e,t){e.preventDefault(),target=e.target,this.dragCounter++,jQuery(target).hasClass("uip-folder-can-drop")?jQuery(target).addClass("uip-background-primary-wash"):jQuery(target).closest(".uip-folder-can-drop").addClass("uip-background-primary-wash")},removeDropClass(e,t){e.preventDefault(),target=e.target,this.dragCounter--,0==this.dragCounter&&(jQuery(target).hasClass("uip-folder-can-drop")?jQuery(target).removeClass("uip-background-primary-wash"):jQuery(target).closest(".uip-folder-can-drop").removeClass("uip-background-primary-wash"))},removeFromFolder(e){this.dragCounter=0;var t=e.dataTransfer.getData("itemID"),r=e.dataTransfer.getData("type");t="folder"==r?[t]:JSON.parse(t),this.removeTheFolder(t,r),jQuery(".uip-folder-can-drop").removeClass("uip-background-primary-wash"),jQuery(".uploader-window").addClass("uip-opacity-0"),jQuery(".uploader-window").removeClass("uip-hidden"),jQuery(".uip-remove-folder").removeClass("uip-nothidden"),setTimeout(function(){jQuery(".uploader-window").removeClass("uip-opacity-0")},1e3)},removeTheFolder(e,t){let r=this;data={action:"uip_remove_from_folder",security:uip_ajax.security,items:e,itemtype:t},jQuery.ajax({url:uip_ajax.ajax_url,type:"post",data:data,success:function(e){data=JSON.parse(e),r.loading=!1,data.error?uipNotification(data.error):(uipNotification(data.message),r.refreshFolders())}})}},template:'<div class="uip-margin-bottom-xs uip-padding-xxs uip-flex">      <div class="uip-text-muted">{{translations.folders}}</div>      <div class="uip-flex-grow uip-margin-left-xs uip-flex">        <div @click="openCreateFolder()"        class="uip-background-muted uip-border-round material-icons-outlined hover:uip-background-grey uip-cursor-pointer">add</div>      </div>      <div @click="openEditFolder()" v-if="!isNaN(activeFolder)"      class="uip-background-muted uip-border-round material-icons-outlined uip-margin-left-xs hover:uip-background-grey uip-cursor-pointer">edit</div>      <div @click="deleteFolder()" v-if="!isNaN(activeFolder)"      class="uip-background-red-wash uip-border-round material-icons-outlined uip-margin-left-xs hover:uip-background-grey uip-cursor-pointer">delete_outline</div>    </div>    <p class="uip-padding-xxs uip-text-muted" v-if="formattedFolders.length < 1">{{translations.noFolders}}</p>    <div class="uip-overflow-auto uip-max-h-400">      <template v-for="folder in formattedFolders">        <create-folder :refreshFolders="refreshFolders" :openFolders="openFolders" :setOpenFolders="setOpenFolders" :folder="folder" :translations="translations" :masterPrefs="masterPrefs" :defaults="defaults" :preferences="preferences"        :activeFolder="activeFolder" :folderUpdate="folderUpdate"></create-folder>      </template>    </div>    \x3c!-- REMOVE FROM FOLDER --\x3e    <div @drop="removeFromFolder($event, folder)"     @dragenter="addDropClass($event, folder)"    @dragleave="removeDropClass($event, folder)"    @dragover.prevent    @dragenter.prevent    class="uip-background-muted uip-border-round uip-flex uip-padding-xs uip-margin-top-s uip-text-m uip-folder-can-drop uip-remove-folder uip-hidden">      {{translations.removeFromFolder}}    </div>    \x3c!-- CREATE NEW FOLDER --\x3e    <div v-if="ui.createNew.open" class="uip-position-fixed uip-w-100p uip-h-viewport uip-hidden uip-text-normal"    :class="{\'uip-nothidden\' : ui.createNew.open}" style="background: rgba(0, 0, 0, 0.3); z-index: 99999; top: 0px; left: 0px; right: 0px; max-height: 100vh;">      \x3c!-- MODAL GRID --\x3e      <div class="uip-flex uip-w-100p uip-h-viewport">        <div class="uip-flex-grow" @click="ui.createNew.open = false"></div>        <div class="uip-w-500 uip-background-default uip-padding-m uip-overflow-auto">          <div class="uk-width-xlarge uk-background-default uk-padding uk-overflow-auto" uk-height-viewport style="max-height: 100vh;">            \x3c!-- NEW FOLDER TITLE --\x3e            <div class="uip-flex uip-margin-bottom-m">              <div class="uip-text-xl uip-text-bold uip-flex-grow">{{translations.newFolder}}</div>              <div class="">                 <span @click="ui.createNew.open = false"                  class="material-icons-outlined uip-background-muted uip-padding-xxs uip-border-round hover:uip-background-grey uip-cursor-pointer">                     close                  </span>              </div>            </div>            \x3c!-- END OF NEW FOLDER TITLE --\x3e            <div class="uip-margin-bottom-s">              <div class="uip-text-muted uip-margin-bottom-xs">{{translations.name}}:</div>              <input class="uip-w-100p uip-standard-input" type="text" :placeholder="translations.folderName" style="padding: 5px 8px;"              v-model="ui.createNew.name">            </div>            <div class="uip-margin-bottom-m">              <div class="uip-text-muted uip-margin-bottom-xs">{{translations.color}}:</div>              <div class="uip-margin-bottom-xm uip-padding-xxs uip-border uip-border-round uip-w-200" style="padding: 5px 8px;">                <div class="uip-flex uip-flex-center">                  <span class="uip-margin-right-xs uip-text-muted uip-margin-right-s">                      <label class="uip-border-circle uip-h-18 uip-w-18 uip-border uip-display-block" v-bind:style="{\'background-color\' : ui.createNew.color}">                        <input                        type="color"                        v-model="ui.createNew.color" style="visibility: hidden;">                      </label>                  </span>                   <input v-model="ui.createNew.color" type="search" placeholder="#HEX" class="uip-blank-input uip-margin-right-s " style="min-width:0;">                  <span class="uip-text-muted">                      <span class="material-icons-outlined uip-text-muted">color_lens</span>                  </span>                </div>              </div>            </div>            <div class="">              <button @click="createFolder()" class="uip-button-default uip-w-100p uip-padding-xs" type="button">{{translations.create}}</button>            </div>          </div>        </div>      </div>      \x3c!-- END OF MODAL GRID --\x3e    </div>    \x3c!-- END OF CREATE NEW FOLDER --\x3e    \x3c!-- EDIT FOLDER --\x3e    <div v-if="ui.edit.open" class="uip-position-fixed uip-w-100p uip-h-viewport uip-hidden uip-text-normal"    :class="{\'uip-nothidden\' : ui.edit.open}" style="background: rgba(0, 0, 0, 0.3); z-index: 99999; top: 0px; left: 0px; right: 0px; max-height: 100vh;">      \x3c!-- MODAL GRID --\x3e      <div class="uip-flex uip-w-100p uip-h-viewport">        <div class="uip-flex-grow" @click="ui.edit.open = false"></div>        <div class="uip-w-500 uip-background-default uip-padding-m uip-overflow-auto">          <div class="uk-width-xlarge uk-background-default uk-padding uk-overflow-auto" uk-height-viewport style="max-height: 100vh;">            \x3c!-- NEW FOLDER TITLE --\x3e            <div class="uip-flex uip-margin-bottom-m">              <div class="uip-text-xl uip-text-bold uip-flex-grow">{{translations.editFolder}}</div>              <div class="">                 <span @click="ui.edit.open = false"                  class="material-icons-outlined uip-background-muted uip-padding-xxs uip-border-round hover:uip-background-grey uip-cursor-pointer">                     close                  </span>              </div>            </div>            \x3c!-- END OF NEW FOLDER TITLE --\x3e            <div class="uip-margin-bottom-s">              <div class="uip-text-muted uip-margin-bottom-xs">{{translations.name}}:</div>              <input class="uip-w-100p uip-standard-input" type="text" :placeholder="translations.folderName" style="padding: 5px 8px;"              v-model="ui.edit.active.title">            </div>            <div class="uip-margin-bottom-m">              <div class="uip-text-muted uip-margin-bottom-xs">{{translations.color}}:</div>              <div class="uip-margin-bottom-xm uip-padding-xxs uip-border uip-border-round uip-w-200" style="padding: 5px 8px;">                <div class="uip-flex uip-flex-center">                  <span class="uip-margin-right-xs uip-text-muted uip-margin-right-s">                      <label class="uip-border-circle uip-h-18 uip-w-18 uip-border uip-display-block" v-bind:style="{\'background-color\' : ui.edit.active.color}">                        <input                        type="color"                        v-model="ui.edit.active.color" style="visibility: hidden;">                      </label>                  </span>                   <input v-model="ui.edit.active.color" type="search" placeholder="#HEX" class="uip-blank-input uip-margin-right-s " style="min-width:0;">                  <span class="uip-text-muted">                      <span class="material-icons-outlined uip-text-muted">color_lens</span>                  </span>                </div>              </div>            </div>            <div class="">              <button @click="updateFolder()" class="uip-button-default uip-w-100p uip-padding-xs" type="button">{{translations.update}}</button>            </div>          </div>        </div>      </div>      \x3c!-- END OF MODAL GRID --\x3e    </div>    \x3c!-- END OF EDIT FOLDER --\x3e'}),UIPfolder.component("create-folder",{props:{translations:Object,masterPrefs:Object,defaults:Object,preferences:Object,folderUpdate:Function,activeFolder:[String,Number],folder:Object,setOpenFolders:Function,openFolders:Array,refreshFolders:Function},data:function(){return{loading:!0,dragCounter:0}},mounted:function(){},methods:{isFolderOpen(e){return!!this.openFolders.includes(e)},startFolderDrag(e,t){e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("itemID",t.id),e.dataTransfer.setData("type","folder"),jQuery(".uploader-window").addClass("uip-hidden"),jQuery(".uip-remove-folder").addClass("uip-nothidden")},addDropClass(e,t){e.preventDefault(),target=e.target,this.dragCounter++,jQuery(target).hasClass("uip-folder-can-drop")?jQuery(target).addClass("uip-background-primary-wash"):jQuery(target).closest(".uip-folder-can-drop").addClass("uip-background-primary-wash")},dragEnd(e,t){jQuery(".uip-folder-can-drop").removeClass("uip-background-primary-wash"),jQuery(".uploader-window").addClass("uip-opacity-0"),jQuery(".uploader-window").removeClass("uip-hidden"),jQuery(".uip-remove-folder").removeClass("uip-nothidden")},removeDropClass(e,t){e.preventDefault(),target=e.target,this.dragCounter--,0==this.dragCounter&&(jQuery(target).hasClass("uip-folder-can-drop")?jQuery(target).removeClass("uip-background-primary-wash"):jQuery(target).closest(".uip-folder-can-drop").removeClass("uip-background-primary-wash"))},dropInfolder(e,t){this.dragCounter=0;var r=e.dataTransfer.getData("itemID"),a=e.dataTransfer.getData("type");"folder"==a&&this.moveFolder(r,t.id),"content"==a&&this.moveContentToFolder(r,JSON.parse(t.id)),jQuery(".uip-folder-can-drop").removeClass("uip-background-primary-wash"),jQuery(".uploader-window").addClass("uip-opacity-0"),jQuery(".uploader-window").removeClass("uip-hidden"),jQuery(".uip-remove-folder").removeClass("uip-nothidden"),setTimeout(function(){jQuery(".uploader-window").removeClass("uip-opacity-0")},1e3)},moveFolder(e,t){let r=this;data={action:"uip_move_folder",security:uip_ajax.security,folderiD:e,destinationId:t},jQuery.ajax({url:uip_ajax.ajax_url,type:"post",data:data,success:function(e){data=JSON.parse(e),r.loading=!1,data.error?uipNotification(data.error):(uipNotification(data.message),r.refreshFolders())}})},moveContentToFolder(e,t){allIDs=JSON.parse(e);let r=this;data={action:"uip_move_content_to_folder",security:uip_ajax.security,contentID:allIDs,destinationId:t},jQuery.ajax({url:uip_ajax.ajax_url,type:"post",data:data,success:function(e){data=JSON.parse(e),r.loading=!1,data.error?uipNotification(data.error):(uipNotification(data.message),r.refreshFolders())}})}},template:'<div>      <div :class="{\'uip-background-muted uip-text-bold uip-text-emphasis\' : activeFolder == folder.id}"      class="uip-border-round uip-flex uip-padding-xxs uip-text-m hover:uip-background-muted uip-margin-bottom-xxs uip-folder-can-drop"      @dragstart="startFolderDrag($event,folder)"      @dragend="dragEnd($event,folder)"      @drop="dropInfolder($event, folder)"       @dragenter="addDropClass($event, folder)"      @dragleave="removeDropClass($event, folder)"      @dragover.prevent      @dragenter.prevent draggable="true">        <span class="material-icons-outlined uip-margin-right-xxs" :style="{\'color\': folder.color}">folder</span>        <span class="uip-flex-grow uip-cursor-pointer" @click="folderUpdate(folder.id, folder)" >{{folder.title}}</span>        <span class="uip-border-round uip-background-primary-wash uip-padding-left-xxs uip-padding-right-xxs">{{folder.count}}</span>        <span class="uip-w-28 uip-text-right">          <span v-if="folder.subs && !isFolderOpen(folder.id)"          class="material-icons-outlined  uip-cursor-pointer" @click="setOpenFolders(folder.id)">chevron_right</span>          <span v-if="folder.subs && isFolderOpen(folder.id)"          class="material-icons-outlined  uip-cursor-pointer" @click="setOpenFolders(folder.id)">expand_more</span>        </span>      </div>      \x3c!-- IF SUB --\x3e      <div class="uip-margin-left-s" v-if="folder.subs && openFolders.includes(folder.id)">        <template v-for="sub in folder.subs">          <create-folder :refreshFolders="refreshFolders" :openFolders="openFolders" :setOpenFolders="setOpenFolders" :folder="sub" :translations="translations" :masterPrefs="masterPrefs" :defaults="defaults" :preferences="preferences"          :activeFolder="activeFolder" :folderUpdate="folderUpdate"></create-folder>        </template>      </div>    </div>'}),UIPfolder.component("premium-feature",{props:{translations:Object},data:function(){return{loading:!0}},mounted:function(){},methods:{},template:'<span class="uip-padding-xxs uip-border-round uip-background-orange uip-text-bold uip-text-white uip-flex">\t  <span class="material-icons-outlined uip-margin-right-xs">\t  \tcard_giftcard\t  </span>  \t  <span>\t\t{{translations.preFeature}}\t  </span>  \t</span>'}),jQuery("#uip-folder-app").length>0&&UIPfolder.mount("#uip-folder-app");